#!/bin/sh 

TC=tomcat6
if [ -z $TC_HOME ]; then
   TC_HOME=/var/lib/$TC
fi

if [ -z $TC_CMD ]; then
   TC_CMD="sudo /sbin/service $TC"
fi

rpm -q $TC > /dev/null
if [ "$?" -ne 0 ]; then
    TC=tomcat5
    rpm -q $TC > /dev/null
    if [ "$?" -ne 0 ]; then
       echo "DEPLOYMENT FAILED: you don't have tomcat installed"
       exit 1
    fi
fi

#buildr candlepin:schema_gen
$TC_CMD stop
#dropdb -U candlepin candlepin
#createdb -U candlepin candlepin
#psql -U candlepin candlepin < target/schemagen/candlepin-proxy.sql
#psql -U candlepin < code/schema/postgresql/populate-defaults.sql

buildr clean package test=no

sudo rm -rf $TC_HOME/webapps/candlepin*
sudo cp target/candlepin-1.0.0.war $TC_HOME/webapps/candlepin.war
$TC_CMD start

sleep 5
echo "Initializing Candlepin..."
wget -qO- http://localhost:8080/candlepin/admin/init
